import MdxLayout from '@/components/mdx-layout'
import { Heading } from '@/components/Heading'
import { Equation, Math, TwoColumnEquations, k, Parameters, DerivedVariables, DecisionVariables, SetsAndIndices, CodeSnippet } from '@/components/optimization'
import q1code from "@/../public/gams/hw1-q1.gms"
import q2code from "@/../public/gams/hw1-q2.gms"
import Image from 'next/image'
// import { Figure1, Figure2 } from './q1-figures'
// import { Figure1 as BeansFigure1, Figure2 as BeansFigure2, FigureProfits } from './q2-figures'


<Heading 
    leftText="Fall 2024" 
    centerText="EBGN645 Computational Economics - HW 2"
    rightText="David Baker"
/>

<div>
<div style={{display:"flex", flexDirection: 'column', marginBottom:"12px"}}>
<img
    sizes="100vw"
    width={200}
    style={{ alignSelf: "end", height: 'auto', maxWidth: "80vw", borderRadius: "12px" }}
    src={"/images/duck-only.png"}
/>

<h1 style={{marginLeft: "12px", alignSelf: 'center'}}>Energy Storage Price Taker Model</h1>
<img
    sizes="100vw"
    width={500}
    style={{ height: 'auto', maxWidth: "80vw", borderRadius: "12px" }}
    src={"/images/battery-chest.png"}
/>
</div>


<SetsAndIndices params={[
    {
        variable: <Math>{(s=>s.raw)`\[s\in \mathcal{S}\]`}</Math>, 
        description: "storage units",
    },
    {
        variable: <Math>{(s=>s.raw)`\[t\in \mathcal{T}\]`}</Math>, 
        description: "time steps—hours of the model horizon (1 year)",
        set:<Math>{(s=>s.raw)`\[t \in \{1,2,3,...,8760\}\]`}</Math>
    }
    ]}
/>


<Parameters params={[
    { variable: <Math>\[c_t\]</Math>, description: <div>electricity price at hour <Math>\[t\]</Math></div>, units: "$/MW" },
    { variable: <Math>{(s =>s.raw)`\[e^{level}_{s1}\]`}</Math>, description: <div>initial energy level of storage unit <Math>\[s\]</Math></div>, units: "MWh" },
    { variable: <Math>{(s =>s.raw)`\[\bar{e}^{level}_s\]`}</Math>, description: <div>maximum energy level of storage unit <Math>\[s\]</Math></div>, units: "MWh" },
    { variable: <Math>{(s =>s.raw)`\[\underline{e}^{level}_s\]`}</Math>, description: <div>minimum energy level of storage unit <Math>\[s\]</Math></div>, units: "MWh" },
    { variable: <Math>{(s=>s.raw)`\[\bar{\Delta}^{d}_{s}\]`}</Math>, description: <div>maximum energy discharge of unit <Math>\[s\]</Math> in a timestep </div>, units: "MWh" },
    { variable: <Math>{(s=>s.raw)`\[\bar{\Delta}^{c}_{s}\]`}</Math>, description: <div>maximum energy charge of unit <Math>\[s\]</Math> in a timestep </div>, units: "MWh" },
    { variable: <Math>{(s=>s.raw)`\[\eta^{d}_{s}\]`}</Math>, description: <div>discharging efficiency of unit <Math>\[s\]</Math></div>, units: "—" },
    { variable: <Math>{(s=>s.raw)`\[\eta^{c}_{s}\]`}</Math>, description: <div>charging efficiency of unit <Math>\[s\]</Math></div>, units: "—" },
    ]}
/>


<DecisionVariables params={[
    { variable: <Math>{(s=>s.raw)`\[E^d_{st}\]`}</Math>, description: <div>energy discharged (sold) from unit <Math>\[s\]</Math> at hour <Math>\[t\]</Math></div>, units: "MWh" },
    { variable: <Math>{(s=>s.raw)`\[E^c_{st}\]`}</Math>, description: <div>energy charged (purchased) by unit <Math>\[s\]</Math> at hour <Math>\[t\]</Math></div>, units: "MWh" },
    { variable: <Math>{(s=>s.raw)`\[E^{level}_{st}\]`}</Math>, description: <div>energy level of unit <Math>\[s\]</Math> at hour <Math>\[t\]</Math>—equivalent to state of charge but using the MWh value instead of a percent</div>, units: "MWh" },
]} />

**Objective:** Maximize profits over the model horizon [$]

<TwoColumnEquations>
    <Equation  eqkey="profit-max">
        <Math>{(s=>s.raw)`\[\max_{E^d_{st}, E^c_{st}} \sum_{s \in \mathcal{S},t \in \mathcal{T}}  c_t E^d_{st} - c_t E^c_{st} \]`[0]}</Math>
        <p>storage profit from buying and selling electricity</p>
      </Equation>
</TwoColumnEquations>


Subject to the following constraints:

<TwoColumnEquations>
    <Equation eqkey="energy-level-bounds">
        <Math>{(s=>s.raw)`\[\underline{e}^{level}_s \leq E^{level}_{st} \leq \bar{e}^{level}_s \quad \forall \ s \in \mathcal{S}, \ t \in \mathcal{T}\]`[0]}</Math>
        <p>energy level bounds</p>
    </Equation>
    <Equation eqkey="initial-condition">
        <Math>{(s=>s.raw)`\[E^{level}_{s1} = e^{level}_{s1}  \quad \forall \ s \in \mathcal{S}\]`[0]}</Math>
        <p style={{alignSelf:"center"}}>initial condition</p>
    </Equation>
    <Equation eqkey="energy-balance">
        <Math>{(s=>s.raw)`\[E^{level}_{s,t+1} = E^{level}_{st} + \eta^c_s E^c_{st} - \frac{E^d_{st}}{\eta_d}  \quad \forall \ s \in \mathcal{S}, \ t \in \mathcal{T}\]`[0]}</Math>
        <p style={{alignSelf:"center"}}>energy balance</p>
    </Equation>
    <Equation eqkey="charge-limits">
        <Math>{(s=>s.raw)`\[E^{level}_{s,t+1} - E^{level}_{st} \leq \bar{\Delta}_s^c \quad \forall \ s \in \mathcal{S}, \ t \in \mathcal{T}\]`[0]}</Math>
        <p style={{alignSelf:"center"}}>charging limit</p>
    </Equation>
    <Equation eqkey="discharge-limits">
        <Math>{(s=>s.raw)`\[E^{level}_{st} - E^{level}_{s,t+1} \leq \bar{\Delta}_s^d \quad \forall \ s \in \mathcal{S}, \ t \in \mathcal{T}\]`[0]}</Math>
        <p style={{alignSelf:"center"}}>discharging limit</p>
    </Equation>
    <Equation eqkey="simul">
        <Math>{(s=>s.raw)`\[E^c_{st} \cdot E^d_{st} = 0 \quad \forall \ s \in \mathcal{S}, \ t \in \mathcal{T}\]`[0]}</Math>
        <p style={{alignSelf:"center"}}>no simultaneous charging and discharging</p>
    </Equation>
    <Equation eqkey="n-n">
        <Math>{(s=>s.raw)`\[E^d_{st}, E^c_{st}, E^{level}_{st} \geq 0 \quad \forall \ s \in \mathcal{S},\ t \in \mathcal{T}\]`[0]}</Math>
        <p>non-negativity</p>
    </Equation>
</TwoColumnEquations>


Assumptions:
- All storage units start at empty.
</div>
{/* 
<br />
<img
    sizes="100vw"
    width={700}
    style={{ height: 'auto', maxWidth: "80vw" }}
    src={"/images/comp-econ-hw1/p1b.png"}
/>

For the counterfactual, we add the following constraint:

<TwoColumnEquations>
    <Math>{(s=>s.raw)`\[X_{rolls} \geq X_{croissants}\]`[0]}</Math>
      (roll-croissant combo)
</TwoColumnEquations>


<br />

<img
    sizes="100vw"
    width={700}
    style={{ height: 'auto', maxWidth: "80vw" }}
    src={"/images/comp-econ-hw1/p1c.png"}
/>

<div style={{display: 'flex'}}>
<Figure1 /><Figure2 />
</div>

- **Business as usual:** 20 croissants are produced with a profit of $60.
- **Combo:** 13.3 croissants and 13.3 rolls are produced with a profit of $46.67.


<CodeSnippet rawStr={q1code} filename="q1.gms"/>

# Problem 2

<img
    sizes="100vw"
    width={300}
    style={{ height: 'auto', maxWidth: "80vw", borderRadius: "20px"}}
    src={"/images/comp-econ-hw1/june.webp"}
/>

![](/images/comp-econ-hw1/p2.png)

<SetsAndIndices params={[
    {
        variable: <Math>{(s=>s.raw)`\[m\in \mathcal{M}\]`}</Math>, 
        description: "machines",
        set:<Math>{(s=>s.raw)`\[m \in \{\text{X1}, \text{X2}\}\]`}</Math>
    },
    {
        variable: <Math>{(s=>s.raw)`\[b\in \mathcal{B}\]`}</Math>, 
        description: "jellybean colors",
        set:<Math>{(s=>s.raw)`\[m \in \{\text{yellow}, \text{blue}, \text{green}, \text{orange}, \text{purple}\}\]`}</Math>
    },{
        variable: <Math>{(s=>s.raw)`\[m, b\in \mathcal{V}\]`}</Math>, 
        description: "valid combinations of machines and jellybeans",
    }
    ]}
/>

<Parameters params={[
    { variable: <Math>\[r_b\]</Math>, description: <div>Net revenue per jellybean of color  <Math>\[b\]</Math></div>, units: "$/bean" },
    { variable: <Math>{(s=>s.raw)`\[\bar{h}\]`}</Math>, description: <div>Maximum hours a machine can run in a week</div>, units: "hours" },
    { variable: <Math>{(s=>s.raw)`\[\bar{p}\]`}</Math>, description: <div>Maximum number of jellybeans produced by a machine over an hour</div>, units: "beans/hour" },
]}
/>

<DecisionVariables params={
    [{ variable: <Math>{(s=>s.raw)`\[X_{mb}\]`}</Math>, 
    description: <div>Quantity of jellybean <Math>\[b\]</Math> produced by machine <Math>\[m\]</Math></div>, 
    units: "beans" }]
} />

**Objective:** Maximize profits over a week [$]

<TwoColumnEquations>
    <Math>{(s=>s.raw)`\[\sum_{m, b \ \in\  \mathcal{V}} (r_b) X_{mb}\]`[0]}</Math>
      (net revenue over all beans and machines)
</TwoColumnEquations>

Subject to the following constraints:

<TwoColumnEquations>
    <Math>{(s=>s.raw)`\[\bar{h}\bar{p} \geq \sum_{b \in \mathcal{B}} X_{mb} \quad \forall \ m \in \mathcal{M}\]`[0]}</Math>
      (jellybean production limit over a week for each machine)
    <Math>{(s=>s.raw)`\[X_{mb} \geq 0 \quad \forall \ m \in \mathcal{M}, b \in \mathcal{B}\]`[0]}</Math>
    (non-negativity)
</TwoColumnEquations>

<br />
<img
    sizes="100vw"
    width={700}
    style={{ height: 'auto', maxWidth: "80vw" }}
    src={"/images/comp-econ-hw1/p2b.png"}
/>

As we would expect, the profit maximizing production profile is for both machines to exclusively produdce green jellybeans. The profit is $8560.

*(Code is at the end of this problem.)*

![](/images/comp-econ-hw1/p2c.png)

I am calling this case *5%*. Profits have dropped to $7962.72. June still produces 8000 jellybeans but as can be seen in the figures below, 
machine X1 now produces blue, orange, and green jellybeans, while machine X2 produces yellow, purple, and green.

<div style={{display: 'flex'}}>
<BeansFigure1 /><BeansFigure2 />
</div>

<FigureProfits />

![](/images/comp-econ-hw1/p2d.png)

I am calling this case *5% and color restrictions*. Profits are the same as in the *5%* case, and total jellybeans by color has also not changed.
The only difference is that the machine production profile has changed slightly, as shown above.

<CodeSnippet rawStr={q2code} filename="q2.gms"/>


</div> */}

export default function MDXPage({ children }) {
    return <MdxLayout>{children}</MdxLayout>

}
